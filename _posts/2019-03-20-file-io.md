---
layout: post
title:  "[Python] File IO"
date:   2019-03-20 09:00:13
categories: 2019-1-systprog
---


# 파일 입출력

파이썬의 파일 입출력은 매우 간편하다. 간단한 예시를 통해 파일 입출력을 경험해보자.

```python
fout = open("testfile.txt", "w")
fout.write("I think Microsoft named .Net so it wouldn’t show up in a Unix directory listing.")
fout.close()
print("file was written")

fin = open("testfile.txt", "r")
contents = fin.read()
fin.close()
print(contents)
```

파일을 열고(open) 쓰고(write) 닫고(close), 파일을 열고(open) 읽고(read) 닫고(close) 이게 거의 전부다. 맨 아래 `print`를 통해 출력되는 문장은 위 코드에서 쓴 것을 출력한 것이 아니라 파일 내용을 읽어서 출력한 것이다.

## 1. 파일 열기

프로그래밍에서 파일을 연다는 것은 파일을 읽거나 쓸수 있는 객체를 생성한다는 것이다. 파이썬에서는 `open()`이라는 함수로 파일 객체를 만들수 있다. `open()`의 프로토타입은 다음과 같다.

```python
open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)
```

- file: 파일 이름을 입력한다. 파일의 경로명과 확장자가 모두 들어가야 하며 경로없이 파일명만 쓰는 경우 현재 폴더에 파일을 읽거나 쓴다.
- mode: 파일을 다룰 모드를 지정한다.
  - `r`: 읽기 모드로서 `file`이 존재해야만 한다. 존재하지 않을 시 `FileNotFoundError`가 난다.
  - `w`: 쓰기 모드로서 파일이 없으면 새 파일을 만들고 있으면 기존 내용을 지우고 빈 파일을 만든다.
  - `a`: 쓰기 모드인데 기존 내용을 보존하고 기존 내용 끝에 새 내용을 추가한다.
- encoding: 문자열은 결국 바이트 코드로 저장이 되는데 문자열을 바이트 코드로 변환하는 과정을 인코딩, 반대 과정을 디코딩이라 한다. 인코딩 방식이 매우 다양한데 방식을 지정하지 않으면 운영체제 기본 값이 들어간다. 윈도우에서는 `cp949`라는 인코딩이 기본인데 이는 윈도우에만 주로 쓰는 것이고 가장 보편적인 인코딩은 `utf-8`이다. 플랫폼 독립적인 코드를 만들기 위해서는 인코딩에도 신경을 써야한다.

더 자세한 내용은 `open()`에 대한 [파이썬 공식문서](https://docs.python.org/3/library/functions.html#open)를 참고하자.  

파일을 열 때 위 예시처럼 `fp = open(filename, mode)` 이렇게 열어도 되지만 이 경우 반드시 `fp.close()`를 실행해야 한다. 코딩을 하다보면 이걸 깜빡하기 쉬운데 이렇게 열고 닫아야 하는 코드가 있을 경우 파이썬에서는 **context manager**라는 기능을 쓴다. `with`라는 키워드로 객체를 생성하고 그 아래 들여쓰기 블록에서 생성된 객체를 사용하고 그 블록을 빠져나가면 자연스럽게 객체가 파괴(close)된다. 아래 예시를 보면 쉽게 이해할 수 있다. 열린 객체를 `fr`로 받고 아래 블록에서 객체를 사용하고 블록을 나가면 자연스럽게 객체가 닫힌다.

```python
with open("testfile.txt", "r") as fr:
    data = fr.read()
    print("check closed under 'with':", fr.closed)
    print(data)

print("check closed outside 'with':", fr.closed)
```

만약 없는 파일을 열려고 하면 어떻게 될까? 쓰기 모드는 새 파일을 만들지만 읽기 모드에서는 에러가 난다. 실제 개발을 할때는 아래 예시처럼 예외처리를 하기보다는 파일이 있는지를 내장 패키지 함수를 통해 확인 후 열게 된다.

```python
try:
    f = open("nofile.txt", "r")
except FileNotFoundError as fe:
    print(fe)
```

## 2. 파일 쓰기

파이썬 파일 입출력 객체는 단순하게 `write()`라는 함수에 문자열을 입력하면 파일에 문자열이 출력된다. 파이썬이 워낙 문자열을 잘 다루다 보니 굳이 숫자를 직접 출력하는 함수는 만들지 않은 듯 하다. 문자열의 리스트를 갖고 있다면 `writelines()`를 쓸 수도 있다. 로이킴의 `봄봄봄` 가사를 파일에 써보자. 여러 줄을 하나의 문자열로 한번에 넣을 수도 있지만 문자열의 리스트로 먼저 가사를 쓴 후 파일에 출력해보자. 하는 김에 줄 번호도 같이 출력해보자.

```python
springx3 = ["봄 봄 봄 봄이 왔네요",
            "우리가 처음 만났던 그때의 향기 그대로",
            "그대가 앉아 있었던 그 벤치 옆에 나무도 아직도 남아있네요",
            "살아가다 보면 잊혀질 거라 했지만",
            "그 말을 하면 안될거란걸 알고 있었소",
            "그대여 너를 처음 본 순간 나는 바로 알았지",
            "그대여 나와 함께 해주오 이 봄이 가기 전에"]

print("\nwrite lyrics into file")
with open("springx3.txt", "w") as f:
    for i, line in enumerate(springx3):
        f.write(f"{i:2}:" + line + "\n")
```

### ~~갑자기 분위기~~ 연습문제

위 예시에서 `for`문을 쓰지 않고 한 번에 문자열을 입력해 보세요. (feat. join 함수)

## 3. 파일 읽기

파이썬 파일 입출력 객체는 세 가지 읽기 함수를 제공한다.

1. read(size=-1): `size`에 해당하는 byte만큼 파일을 읽어 하나의 `str` 객체로 리턴한다. 기본 값 -1로 두면 파일 끝까지 읽는다.
2. readline(): 파일을 한 줄씩 `str` 객체로 읽는다. 다 읽으면 `None`을 출력한다.
3. readlines(): 전체 파일을 한 줄씩 `str` 객체로 읽어서 `list of str`을 출력한다.

위 세 가지 함수를 이용해 `봄봄봄` 가사를 파일로부터 읽어와 출력하는 함수를 만들어보자.

1) read()
```python
print("use read")
with open("springx3.txt", "r") as f:
    lyrics = f.read()
    print(lyrics)
```

2) readline()
```python
print("use readline")
with open("springx3.txt", "r") as f:
    lyrics = []
    line = f.readline()
    while line:
        line = line.rstrip("\n")
        lyrics.append(line)
        line = f.readline()
print("\n".join(lyrics))
```

3) readlines()
```python
print("use readlines")
with open("springx3.txt", "r") as f:
    lyrics = f.readlines()
    lyrics = [line.rstrip("\n") for line in lyrics]
    print("\n".join(lyrics))
```

### 연습문제

다음은 2x2 행렬을 나타내는 문자열이다. 이를 파일로 출력 후 다시 파일을 읽어서 2중 리스트에 저장한 후 행렬의 determinant를 구하시오.

```python
matrix_str = "4 2\n5 3"
# matrix.txt 에 저장

# 파일 읽어서 matrix에 2중 리스트로 저장

print("read matrix:", matrix)
# => read matrix: [[4, 2], [5, 3]]
# determinant 계산

```



